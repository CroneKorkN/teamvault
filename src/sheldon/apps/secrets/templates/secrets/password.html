{% extends "base_nav.html" %}
{% load humanize %}
{% load staticfiles %}
{% block "css" %}
<link href="{% static 'css/secrets.css' %}" rel="stylesheet">
{% endblock %}
{% block "js" %}
<script src="{% static 'bundled/underscore-1.6.0.min.js' %}"></script>
<script src="{% static 'bundled/bigtext-0.1.5.js' %}"></script>
{% endblock %}
{% block "content" %}
<script type="text/javascript">
var reveal_placeholder = "{{ placeholder }}";
var reveal_toggled = false;
$(function () {
	$("[data-toggle='tooltip']").tooltip({container: 'body'});
});
function getPassword(callback) {
	$.ajax({
		url: "{{ secret_url }}",
		type:"get",
		dataType: "json",
		success: function(data){
			callback(data['password']);
		},
	});
}
function largeType(password) {
	$('.large-type').removeClass('hidden');
	$('.large-type').html("<div>" + password + "</div>");
	$('.large-type').bigtext();
	$('.large-type').mousedown(function () {
		$('.large-type').addClass('hidden');
		$('.large-type').html("");
	});
}
function reveal(password) {
	if (reveal_toggled == true) {
		$('#reveal-button').attr('title', "Reveal as plain text").tooltip('fixTitle').tooltip('show');
		$('#reveal-button i').removeClass('fa-shield');
		$('#reveal-button i').addClass('fa-magic');
		$('.password-field').val(reveal_placeholder);
		$('.password-field').attr('disabled', true);
		reveal_toggled = false;
	}
	else {
		$('#reveal-button').attr('title', "Hide plain text").tooltip('fixTitle').tooltip('show');
		$('#reveal-button i').removeClass('fa-magic');
		$('#reveal-button i').addClass('fa-shield');
		$('.password-field').val(password);
		$('.password-field').attr('disabled', false);
		reveal_toggled = true;
	}
}
</script>
<div class="large-type hidden"></div>
<div class="container">
	<div class="row">
		<div class="col-md-10 password-title">
			<h1>{{ password.name }}</h1>
		</div>
		<div class="col-md-1 col-md-offset-1 password-icons">
			<h1>
				{% if readable %}
				<i class="fa fa-unlock"></i>
				{% else %}
				<i class="fa fa-lock"></i>
				{% endif %}
			</h1>
		</div>
	</div>
	<div class="row">
		<div class="col-md-8 password-main">
			<div class="input-group input-group-lg">
				<input type="text" class="form-control password-field" value="{{ placeholder }}" autocomplete="off" disabled>
				<span class="input-group-btn">
					<button class="btn btn-default" type="button" data-toggle="tooltip" data-placement="top" title="Copy to clipboard" onclick="getPassword(alert)">
						<i class="fa fa-clipboard"></i>
					</button>
					<button id="reveal-button" class="btn btn-default" type="button" data-toggle="tooltip" data-placement="top" title="Reveal as plain text" onclick="getPassword(reveal)">
						<i class="fa fa-magic"></i>
					</button>
					<button class="btn btn-default" type="button" data-toggle="tooltip" data-placement="top" title="Show in large type" onclick="getPassword(largeType);">
						<i class="fa fa-font"></i>
					</button>
				</span>
			</div>
			<hr>
			<div class="btn-group btn-group-justified">
				<div class="btn-group">
					<button type="button" class="btn btn-default btn-lg"><i class="fa fa-pencil"></i>&nbsp; Edit</button>
				</div>
				<div class="btn-group">
					<button type="button" class="btn btn-default btn-lg"><i class="fa fa-times"></i>&nbsp; Delete</button>
				</div>
				<div class="btn-group">
					<button type="button" class="btn btn-default btn-lg"><i class="fa fa-share"></i>&nbsp; Share</button>
				</div>
			</div>
		</div>
		<div class="col-md-3 col-md-offset-1 password-meta">
			<table>
				<tr>
					<td>Changed</td>
					<td>{{ password.current_revision.created|naturalday:"Y-m-d" }}</td>
				</tr>
				<tr>
					<td>Changed by</td>
					<td>{{ password.current_revision.set_by.username }}</td>
				</tr>
				<tr>
					<td class="separator"></td>
					<td class="separator"></td>
				</tr>
				<tr>
					<td>Created</td>
					<td>{{ password.created|naturalday:"Y-m-d" }}</td>
				</tr>
				<tr>
					<td>Created by</td>
					<td>{{ password.created_by }}</td>
				</tr>
			</table>
		</div>
	</div>
</div>
{% endblock %}
